Function.prototype.bind=function(){}.bind||function(t){function e(){}if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var n=[].slice,r=n.call(arguments,1),i=this,o=function(){return i.apply(this instanceof e?this:t||window,r.concat(n.call(arguments)))};return e.prototype=this.prototype,o.prototype=new e,o};var TGE=function(t,e,n){this.version="1.1",this.cmds={history:[],count:0,current:0};var r=function(t,e,n){t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent?t.attachEvent("on"+e,n):t["on"+e]=n},i=function(t,e){return e?document.querySelectorAll(t):document.querySelector(t)},o=function(t,e){terminal.innerHTML+="<div>"+("cmd"==e?TGE.path.get():"")+("cmd"==e?this.config.game.terminal:"")+("cmd"==e?t.replaceHTMLCharacters():t.replaceHTMLCharacters().replaceChatColors()).nl2br().trim()+"</div>",document.body.scrollTop=document.body.scrollHeight}.bind(this),s=function(){var t,e=Object.keys(this.commands);for(o("\n----- Commands ------------------------------"),o(" ?,help - Shows this help."),t=0;t<e.length;t++)this.commands[e[t]].hasOwnProperty("description")&&o(" "+e[t]+" - "+this.commands[e[t]].description)}.bind(this),a=function(t){var e,n=t[0],r=t[1];if(0!=n.length)return"github"==n?(e=window.open("https://github.com/PDKnight/","_blank"),e.focus()):(0==Object.keys(this.commands).length&&o('[Warning] There are no commands set in engine! Type "github" to open TGE github page.'),this.commands.hasOwnProperty(n)&&(this.commands[n].hasOwnProperty("description")||o("[Warning] The command has no description set yet!"),this.commands[n].hasOwnProperty("exec")||o("[Warning] The command has no exec function set yet!"))),"?"==n||"help"==n?void s():void(this.commands.hasOwnProperty(n)?this.commands[n].hasOwnProperty("exec")?this.commands[n].exec(r):this.log('&c[Error] The command "'+n+'" has no exec function set yet.'):this.log('&c[Error] Unknown command "'+n+'".'))}.bind(this),c=function(t){var e,n;return e=n="",t=t.replace(/\s+/," ").split(" "),e=t[0],t.shift(),n=t,[e,n]},h=function(){String.prototype.trim=function(){return this.replace(/^\s*|\s*$/g,"")},String.prototype.replaceHTMLCharacters=function(){return this.replace(/<|>|&| /g,function(t){return{"<":"&lt;",">":"&gt;","&":"&amp;"," ":"&nbsp;"}[t]})},String.prototype.nl2br=function(){return this.replace(/\r|\n/g,"<br>")},String.prototype.replaceChatColors=function(){window;return this.replace(/&amp;(r|[0-9a-f])/g,function(t){return'<font color="#'+{0:"000",1:"00A",2:"0A0",3:"0AA",4:"A00",5:"A0A",6:"FA0",7:"AAA",8:"555",9:"55F",a:"5F5",b:"5FF",c:"F55",d:"F5F",e:"FF5",f:"FFF",r:e.game.textColor.slice(1)}[t[t.length-1]]+'">'})};var t=i(this.environment);if(!t)throw new Error("Unknown element selector "+this.environment+". Please make sure you haven't make any mistake.");var n=function(e,n,r){var i=document.createElement(e);for(param in n)"inner"==param?i.innerHTML=n[param]:i[param]=n[param];r?r.appendChild(i):t.appendChild(i)};n("div",{id:"terminal"}),n("span",{id:"cmdline",inner:TGE.path.get()+this.config.game.terminal.replaceHTMLCharacters()}),n("div",{id:"cursor",className:"off"}),n("input",{id:"input",type:"text"});var s=i(this.environment+" #input");document.title=this.config.game.name,document.body.style.background=this.config.game.bgColor,document.body.style.color=this.config.game.textColor,document.body.style.overflow=this.config.game.scrollable?"":"hidden",o(this.config.welcome.replace(/%version%/g,this.version));var h=function(){s.focus(),setTimeout(function(){s.selectionStart=s.selectionEnd=1e5},0)};r(document,"keydown",h),r(document,"keyup",h),r(document,"click",h),r(s,"blur",h);var m=function(t){var e=s.value.trim(),n=t.keyCode||t.which;if(13==n&&e.length>0){s.value="",o(e,"cmd");var r=c(e);a(r),this.cmds.history.push(e),this.cmds.count++,this.cmds.current=this.cmds.count}if("keydown"==t.type)switch(n){case 38:this.cmds.current>0&&(this.cmds.current--,s.value=this.cmds.history[this.cmds.current]);break;case 40:this.cmds.current<this.cmds.count-1?(this.cmds.current++,s.value=this.cmds.history[this.cmds.current-1]):(s.value="",this.cmds.current==this.cmds.count-1&&this.cmds.current++)}8==n&&0==s.value.length&&(t.preventDefault?t.preventDefault():t.returnValue=!1,s.focus()),i(this.environment+" #cmdline").innerHTML=TGE.path.get()+this.config.game.terminal.replaceHTMLCharacters()+s.value.replaceHTMLCharacters()}.bind(this);r(s,"keydown",m),r(s,"keyup",m),XXHR().request(this.config.map+this.getUrlPath(),function(t){var e=JSON.parse(t.toString()),n=e.type,r=e.data,i=(r.dirs,r.message);switch(r.hasOwnProperty("items")&&!r.items&&TGE.getInstance().log('&c[Error] You need an item to go there. Use "pick" command to pick an item.'),n){case"map":r.hasOwnProperty("text")&&r.text.length>0&&TGE.getInstance().log(r.text.join("\n")+"\n");break;case"error":default:TGE.getInstance().log("&c[Error] "+("error"==n?i:"Unknown error type: "+n))}},function(t){TGE.getInstance().log("&c[Error] An error happened with AJAX request. Message: "+t)}),setInterval(function(){var t="on"==(cursor.className||"off")?"off":"on";cursor.className=t},600)}.bind(this);this.environment=t,this.config=e,this.commands=n,this.log=o,this.sel=i,this.items=[],this.getUrlPath=function(){return"?dir="+(TGE.path.path||"home")+"&items="+this.items.join(",")}.bind(this),this.getUrlItems=function(){return"&items="+this.items.join(",")}.bind(this),h()};TGE.getInstance=function(){return window[TGE.instanceName]},TGE.getInstanceName=function(){return TGE.instanceName},TGE.path={pathPrefix:"C:/",path:"",get:function(){return this.pathPrefix+this.path},set:function(t){this.path=t},cd:function(t,e,n){var r=t.split("/"),e=e||(r.length>0?r:e);if(e.length>1&&"number"!=typeof n)this.cd(e[0],e,0);else if(t.length>0)if(".."==t){var i=this.path.split("/");i.pop(),this.path=i.join("/");var o=TGE.getInstance().config.map;if(!o)return void TGE.getInstance().log("[Warning] There is no map set in config file!");var s=this.path;"/"==s[0]&&(s=s.slice(1)),XXHR().request(o+"?dir="+(s||"Home")+TGE.getInstance().getUrlItems(),function(t){var r=JSON.parse(t.toString()),i=r.type,o=r.data,s=(o?o.dirs:[],o?o.message:[]);switch(o.hasOwnProperty("items")&&!o.items&&TGE.getInstance().log('&c[Error] You need an item to go there. Use "pick" command to pick an item.'),i){case"map":o.hasOwnProperty("text")&&o.text.length>0&&TGE.getInstance().log(o.text.join("\n")+"\n");break;case"error":default:TGE.getInstance().log("&c[Error] "+("error"==i?s:"Unknown error type: "+i))}n<e.length-1&&this.cd(e[n+1],e,n+1)}.bind(this),function(t){TGE.getInstance().log("&c[Error] An error happened with AJAX request. Message: "+t)})}else{var o=TGE.getInstance().config.map;if(!o)return void TGE.getInstance().log("[Warning] There is no map set in config file!");var s=this.path+"/"+t;"/"==s[0]&&(s=s.slice(1)),XXHR().request(o+"?dir="+(s||"Home")+TGE.getInstance().getUrlItems(),function(r){var i=JSON.parse(r.toString()),o=i.type,s=i.data,a=s?s.dirs:[],c=s?s.message:[];switch(s.hasOwnProperty("items")&&!s.items&&TGE.getInstance().log('&c[Error] You need an item to go there. Use "pick" command to pick an item.'),o){case"map":if(a.length>0){s.hasOwnProperty("text")&&s.text.length>0&&TGE.getInstance().log(s.text.join("\n")+"\n"),this.path+=(this.path.indexOf("/")==this.path.length-1?"":"/")+t;var h=TGE.getInstance();h.sel(h.environment+" #cmdline").innerHTML=TGE.path.get()+h.config.game.terminal.replaceHTMLCharacters()+h.sel(h.environment+" #input").value.replaceHTMLCharacters()}break;case"error":default:TGE.getInstance().log("&c[Error] "+("error"==o?c:"Unknown error type: "+o))}n<e.length-1&&this.cd(e[n+1],e,n+1)}.bind(this),function(t){TGE.getInstance().log("&c[Error] An error happened with AJAX request. Message: "+t)})}}};
